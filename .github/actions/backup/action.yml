name: "Database Backup"
description: "Creates a backup of the database before deployment"

inputs:
  environment:
    description: "Environment to backup (dev or prd)"
    required: true
  ssh-key:
    description: "SSH private key"
    required: true
  vps-host:
    description: "VPS hostname"
    required: true
  vps-user:
    description: "VPS user"
    required: true

outputs:
  backup-file:
    description: "Path to the created backup file"
    value: ${{ steps.backup.outputs.file }}

runs:
  using: "composite"
  steps:
    - name: Create database backup
      id: backup
      shell: bash
      run: |
        set -e

        echo "ðŸ“¦ Executando backup no ambiente: ${{ inputs.environment }}"
        echo ""

        ssh -i ~/.ssh/id_rsa -o StrictHostKeyChecking=no ${{ inputs.vps-user }}@${{ inputs.vps-host }} \
          "cd /home/deploy/gas-e-agua-backend && bash ./scripts/deploy/backup-db.sh ${{ inputs.environment }}"

        echo ""
        echo "âœ… Backup concluÃ­do com sucesso!"
